<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Title - Zawadi Careers</title>
    <link rel="stylesheet" href="css/blog.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="assets/images/zawadi-logo.png">
</head>
<body>
    <!-- Navigation (Same as index.html) -->
    <nav class="navbar">
        <!-- Same navigation as index.html -->
    </nav>

    <!-- Blog Detail Container -->
    <div class="blog-detail-container" id="blogDetailContainer">
        <!-- Blog content will be loaded here dynamically -->
        
        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
            <div class="loading-content">
                <div class="loader"></div>
                <p>Loading article...</p>
            </div>
        </div>
        
        <!-- Error State -->
        <div class="error-state" id="errorState" style="display: none;">
            <div class="error-content">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Article Not Found</h3>
                <p>The article you're looking for doesn't exist or has been moved.</p>
                <a href="blog.html" class="btn-primary">Back to Blog</a>
            </div>
        </div>
    </div>

    <!-- Reading Progress Bar -->
    <div class="reading-progress">
        <div class="progress-bar" id="progressBar"></div>
        <div class="progress-info">
            <span id="currentPage">1</span> of <span id="totalPages">1</span>
        </div>
    </div>

    <!-- Reading Navigation -->
    <div class="reading-navigation">
        <button class="nav-btn prev-btn" id="prevBtn">
            <i class="fas fa-chevron-left"></i>
            <span>Previous</span>
        </button>
        
        <div class="reading-stats">
            <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span id="readingTime">5 min</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-eye"></i>
                <span id="viewCount">0</span>
            </div>
        </div>
        
        <button class="nav-btn next-btn" id="nextBtn">
            <span>Next</span>
            <i class="fas fa-chevron-right"></i>
        </button>
    </div>

    <!-- Mobile Quick Actions -->
    <div class="mobile-quick-actions">
        <button class="quick-action" id="mobileShareBtn">
            <i class="fas fa-share-alt"></i>
            <span>Share</span>
        </button>
        <button class="quick-action" id="mobileCopyBtn">
            <i class="fas fa-link"></i>
            <span>Copy Link</span>
        </button>
    </div>

    <!-- Related Articles / Recent Posts -->
    <section class="related-articles">
        <div class="container">
            <h2><i class="fas fa-link"></i> Recent Articles</h2>
            <div class="related-grid" id="relatedArticles">
                <!-- Loading state for related articles -->
                <div class="loading-related">Loading recent articles...</div>
            </div>
        </div>
    </section>

    <!-- Newsletter Prompt -->
    <div class="newsletter-prompt" id="newsletterPrompt">
        <div class="prompt-content">
            <button class="close-prompt">&times;</button>
            <div class="prompt-icon">
                <i class="fas fa-envelope-open-text"></i>
            </div>
            <h3>Enjoying this article?</h3>
            <p>Subscribe to get more career insights like this delivered to your inbox weekly.</p>
            <form class="prompt-newsletter-form">
                <input type="email" placeholder="Enter your email" required>
                <button type="submit">Subscribe Now</button>
            </form>
        </div>
    </div>

    <!-- Footer (Same as index.html) -->
    <footer class="footer">
        <!-- Same footer as index.html -->
    </footer>

    <!-- Mobile Bottom Navigation -->
    <div class="mobile-bottom-nav">
        <a href="index.html" class="nav-icon">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="blog.html" class="nav-icon">
            <i class="fas fa-blog"></i>
            <span>Blog</span>
        </a>
        <button class="nav-icon" id="detailShareBtn">
            <i class="fas fa-share-alt"></i>
            <span>Share</span>
        </button>
        <button class="nav-icon" id="detailCopyBtn">
            <i class="fas fa-link"></i>
            <span>Copy Link</span>
        </button>
    </div>

    <script src="js/supabase.js" type="module"></script>
    <script src="js/main.js" type="module"></script>
    <script src="js/blog.js" type="module"></script>
    <script type="module">
    import supabase from './js/supabase.js';
    import { getCategoryName } from './js/main.js';

    // Get blog ID from URL
    const urlParams = new URLSearchParams(window.location.search);
    const blogId = urlParams.get('id');
    
    // Load main blog detail
    if (blogId) {
        import('./js/blog.js').then(module => {
            module.loadBlogDetail(blogId);
        }).catch(error => {
            console.error('Error loading blog module:', error);
            document.getElementById('errorState').style.display = 'flex';
            document.getElementById('loadingState').style.display = 'none';
        });
    } else {
        document.getElementById('errorState').style.display = 'flex';
        document.getElementById('loadingState').style.display = 'none';
    }

    // Load recent articles (excluding current blog)
    async function loadRecentArticles() {
        try {
            const relatedGrid = document.getElementById('relatedArticles');
            
            let query = supabase
                .from('blogs')
                .select('*')
                .eq('status', 'published')
                .order('created_at', { ascending: false })
                .limit(3); // Show 3 recent articles

            // Exclude current blog if we're on a detail page
            if (blogId) {
                query = query.neq('id', blogId);
            }

            const { data: blogs, error } = await query;

            if (error) throw error;
            
            if (!blogs || blogs.length === 0) {
                relatedGrid.innerHTML = '<p class="no-articles">No recent articles found.</p>';
                return;
            }

            // Display recent articles
            relatedGrid.innerHTML = blogs.map(blog => {
                const imageUrl = blog.image_url || blog.featured_image || blog.thumbnail;
                const formattedDate = new Date(blog.created_at).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric'
                });
                const excerpt = blog.excerpt || (blog.content ? blog.content.replace(/<[^>]*>/g, '').substring(0, 100) + '...' : '');
                const categoryName = getCategoryName(blog.category_id);
                
                return `
                    <a href="blog-detail.html?id=${blog.id}" class="related-card">
                        <div class="related-image">
                            ${imageUrl ? 
                                `<img src="${imageUrl}" alt="${blog.title}" loading="lazy">` : 
                                `<div class="related-image-placeholder">${categoryName[0]}</div>`
                            }
                        </div>
                        <div class="related-content">
                            <span class="related-category">${categoryName}</span>
                            <h3 class="related-title">${blog.title}</h3>
                            <div class="related-meta">
                                <span><i class="far fa-calendar-alt"></i> ${formattedDate}</span>
                                <span><i class="far fa-clock"></i> ${blog.read_time || '3'} min read</span>
                            </div>
                            <p class="related-excerpt">${excerpt}</p>
                            <span class="related-read-more">
                                Read Article <i class="fas fa-arrow-right"></i>
                            </span>
                        </div>
                    </a>
                `;
            }).join('');

        } catch (error) {
            console.error('Error loading recent articles:', error);
            document.getElementById('relatedArticles').innerHTML = 
                '<p class="error-articles">Failed to load recent articles.</p>';
        }
    }

    // Load recent articles when page loads
    document.addEventListener('DOMContentLoaded', function() {
        loadRecentArticles();
    });

    </script>
</body>
</html>